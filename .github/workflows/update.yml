name: Daily Crypto Price Fetch

on:
  schedule:
    - cron: '0 12 * * *'
  workflow_dispatch:

jobs:
  fetch-and-commit:
    runs-on: ubuntu-latest
    steps:
      - name: Set up Git and clone with token
        env:
          GH_TOKEN: ${{ secrets.GH_PAT }}
        run: |
          echo "Token length: ${#GH_TOKEN}"
          git config --global user.name "zeketests"
          git config --global user.email "67669609+zeketests@users.noreply.github.com"
          git clone https://x-access-token:${GH_TOKEN}@github.com/zeketests/crypto-daily-prices.git repo
          cd repo
          pip install requests
          python top100_crypto_prices.py
          git add .
          git commit -m "Daily update - $(date '+%Y-%m-%d')" || exit 0
          git push origin HEAD:main
